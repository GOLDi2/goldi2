{"version":3,"file":"treeController.js","sourceRoot":"","sources":["treeController.ts"],"names":[],"mappings":"AAqBA;;;;;GAKG;AACH;IAQI,YAAY,eAAiC;QAErC,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;QACvC,IAAI,CAAC,IAAI,GAAc,IAAI,CAAC,SAAS,EAAE,CAAC;IAE5C,CAAC;IAEG,iBAAiB,CAAC,GAAa;QAE/B,MAAM,QAAQ,GAAgB,EAAE,CAAC;QACjC,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,GAAG;YAEA,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,qBAAqB,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACjG,CAAC,CAAC,CAAC;QAC1B,MAAM,CAAC;YACH,KAAK,EAAG,GAAG,CAAC,IAAI,EAAE,MAAM,EAAG,IAAI,EAAE,YAAY,EAAG,IAAI,EAAE,GAAG,EAAG,GAAG,CAAC,EAAE,EAAE,QAAQ,EAAG,QAAQ;SAC1F,CAAC;IACN,CAAC;IAEG,mBAAmB,CAAC,IAAa,EAAE,EAA0B;QAE7D,MAAM,CAAC;YACH,KAAK,EAAG,IAAI,EAAE,GAAG,EAAG,EAAE,CAAC,WAAW,EAAE,IAAI,EAAG,EAAE;SAChD,CAAC;IACN,CAAC;IAEL;;OAEG;IACK,gBAAgB;QAEhB,MAAM,aAAa,GAAG,EAAE,CAAC;QACzB,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE;aAC9B,OAAO,CAAC,CAAC,GAAG;YAEA,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,CAAC;QACpD,CAAC,CAAC,CAAC;QAChB,MAAM,CAAC,aAAa,CAAC;IACzB,CAAC;IAEE,UAAU;QAET,IAAI,CAAC,IAAI;aACJ,MAAM,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC;IACzC,CAAC;IAEL;;;OAGG;IACI,UAAU,CAAC,GAAa;QAEvB,IAAI,CAAC,IAAI;aACJ,WAAW,EAAE;aACb,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,CAAC;IAClD,CAAC;IAEE,YAAY,CAAC,WAAmC;QAE/C,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,SAAS,CAAC;aAClC,WAAW,CAAC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,eAAe,CAAC,oBAAoB,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC,CAAC;IACzH,CAAC;IAEE,WAAW,CAAC,EAAW;QAEtB,MAAM,CAAC,IAAI,CAAC,IAAI;aACJ,YAAY,CAAC,EAAE,CAAC,CAAC;IACjC,CAAC;IAEL;;;;OAIG;IACK,UAAU,CAAC,QAAQ;QAEnB,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CACxB,CAAC;YACG,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CACrD,CAAC;gBACG,QAAQ,CAAC,MAAM,EAAE,CAAC;YACtB,CAAC;QACL,CAAC;QACD,IAAI,CACJ,CAAC;YACG,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAC9D,CAAC;gBACG,QAAQ,CAAC,MAAM,EAAE,CAAC;YACtB,CAAC;QACL,CAAC;IACL,CAAC;IAAA,CAAC;IAEE,kBAAkB,CAAC,IAAI;QAEvB,IAAI,OAAO,CAAC;QACZ,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CACjE,CAAC;YACG,OAAO,GAAG,+CAA+C,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClF,CAAC;QACD,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CACjF,CAAC;YACG,OAAO,GAAG,iDAAiD,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QACpF,CAAC;QACD,IAAI,CACJ,CAAC;YACG,cAAc;YACd,MAAM,CAAC;QACX,CAAC;QACD,IAAI,YAAY,CAAC,OAAO,EAAE;YAEtB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC1B,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IACd,CAAC;IAEL;;OAEG;IACK,SAAS;QAET,IAAI,cAAc,GAAG,IAAI,CAAC,CAAC,wBAAwB;QACnD,MAAM,KAAK,GAAU,CAAC,CAAC,OAAO,CAAC,CAAC;QAChC,KAAK,CAAC,SAAS,CAAoB;YAE/B,QAAQ,EAAU,KAAK;YACvB,UAAU,EAAQ,CAAC;YACnB,UAAU,EAAQ,CAAC;YACnB,MAAM,EAAY,IAAI,CAAC,gBAAgB,EAAE;YACzC,eAAe,EAAG,CAAC;YACnB,WAAW,EAAO,IAAI;YACtB,cAAc,EAAI,CAAC;YACnB,UAAU,EAAQ,CAAC,aAAa,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,CAAC;YACzD,wCAAwC;YACxC,WAAW,EAAO;gBACd,IAAI,EAAM,UAAS,IAAI;oBAEnB,MAAM,KAAK,GAAO,eAAe,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBAC3D,MAAM,OAAO,GAAK,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,eAAe,CAAC,YAAY,CAAC;oBACrF,MAAM,SAAS,GAAG,KAAK,IAAI,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBAC9E,MAAM,CAAC;wBACH,MAAM,EAAK,EAAC,IAAI,EAAG,MAAM,EAAE,MAAM,EAAG,MAAM,EAAE,QAAQ,EAAG,OAAO,EAAC;wBAC/D,MAAM,EAAK,WAAW;wBACtB,QAAQ,EAAG,EAAC,IAAI,EAAG,QAAQ,EAAE,MAAM,EAAG,QAAQ,EAAE,QAAQ,EAAG,SAAS,EAAC;qBACxE,CAAC;gBACN,CAAC;gBACD,OAAO,EAAG,UAAS,IAAI,EAAE,MAAM;oBAE3B,EAAE,CAAC,CAAC,MAAM,IAAI,QAAQ,CAAC,CACvB,CAAC;wBACG,cAAc,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;oBAC5C,CAAC;oBACD,EAAE,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,CACrB,CAAC;wBACG,cAAc,CAAC,eAAe,CAAC,mBAAmB,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAChF,CAAC;gBACL,CAAC;aACJ;YACD,KAAK,EAAa,UAAS,KAAK,EAAE,IAAI;gBAElC,CAAC,CAAC,sBAAsB,CAAC;qBACpB,MAAM,CAAC,QAAQ,EAAE,mBAAmB,CAAC,CAAC;gBAC3C,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,IAAI,eAAe,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CACtE,CAAC;oBACG,MAAM,CAAC,KAAK,CAAC;gBACjB,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC;YAChB,CAAC;YACD,QAAQ,EAAU,UAAS,KAAK,EAAE,IAAI;gBAElC,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,KAAK,eAAe,CAAC,YAAY,CAAC,CACtF,CAAC;oBACG,MAAM,CAAC,KAAK,CAAC;gBACjB,CAAC;gBACD,cAAc,CAAC,eAAe,CAAC,mBAAmB,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACjF,MAAM,CAAC,IAAI,CAAC;YAChB,CAAC;YACD,OAAO,EAAW,UAAS,KAAK,EAAE,IAAI;gBAElC,MAAM,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CACpB,CAAC;oBACG,KAAK,EAAE;wBACH,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;wBAC3B,MAAM,CAAC,IAAI,CAAC;oBAChB,KAAK,EAAE;wBACH,cAAc,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBAC7C,MAAM,CAAC,IAAI,CAAC;oBAChB;wBACI,MAAM,CAAC,IAAI,CAAC;gBACpB,CAAC;YACL,CAAC;YACD,KAAK,EAAa;gBACd,GAAG,EAAG;oBACF,GAAG,EAAgB,gCAAgC;oBACnD,OAAO,EAAY,0BAA0B;oBAC7C,QAAQ,EAAW,+BAA+B;oBAClD,gBAAgB,EAAG,2BAA2B;oBAC9C,eAAe,EAAI,2BAA2B;oBAC9C,UAAU,EAAS,0BAA0B;oBAC7C,UAAU,EAAS,iCAAiC;oBACpD,KAAK,EAAc,kCAAkC;oBACrD,cAAc,EAAK,gCAAgC;oBACnD,YAAY,EAAO,gCAAgC;oBACnD,YAAY,EAAO,+BAA+B;oBAClD,MAAM,EAAa,kCAAkC;oBACrD,UAAU,EAAS,iCAAiC;oBACpD,OAAO,EAAY,4CAA4C;iBAClE;aACJ;YACD,IAAI,EAAc,UAAS,KAAK,EAAE,IAAI;gBAElC,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,KAAK,eAAe,CAAC,cAAc,CAAC,CAC7E,CAAC;oBACG,MAAM,CAAC,0BAA0B,CAAC;gBACtC,CAAC;gBACD,IAAI,CACJ,CAAC;oBACG,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CACjC,CAAC;wBACG,KAAK,eAAe,CAAC,YAAY;4BAC7B,MAAM,CAAC,6CAA6C,CAAC;wBACzD,KAAK,eAAe,CAAC,cAAc;4BAC/B,MAAM,CAAC,4BAA4B,CAAC;oBAC5C,CAAC;gBACL,CAAC;YACL,CAAC;YACD,GAAG,EAAe;gBACd,YAAY,EAAY,GAAG;gBAC3B,YAAY,EAAY,IAAI;gBAC5B,gBAAgB,EAAQ,IAAI;gBAC5B,qBAAqB,EAAG,IAAI;gBAC5B,SAAS,EAAe,UAAS,IAAI,EAAE,IAAI;oBAEvC,CAAC,CAAC,sBAAsB,CAAC;yBACpB,IAAI,CAAC,QAAQ,EAAE,mBAAmB,CAAC,CAAC;oBACzC,MAAM,CAAC,CAAC,eAAe,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACrD,CAAC;gBACD,SAAS,EAAe,UAAS,IAAI,EAAE,IAAI;oBAGvC,gDAAgD;oBAChD,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CACjJ,CAAC;wBACG,4CAA4C;wBAC5C,MAAM,CAAC,OAAO,CAAC;oBACnB,CAAC;oBACD,yDAAyD;oBACzD,yCAAyC;oBACzC,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,IAAI,eAAe,CAAC,cAAc,IAAI,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CACnI,CAAC;wBACG,MAAM,CAAC,MAAM,CAAC;oBAClB,CAAC;oBACD,MAAM,CAAC,KAAK,CAAC;gBACjB,CAAC;gBACD,QAAQ,EAAgB,UAAS,IAAI,EAAE,IAAI;oBAEvC;;uBAEG;oBAGH,4FAA4F;oBAG5F,sCAAsC;oBACtC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CACjD,CAAC;wBACG,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,cAAc,CAAC,eAAe,CAAC,mBAAmB,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CACxG,CAAC;4BACG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;wBAC9C,CAAC;wBACD,IAAI,CAAC,EAAE,CAAC,CAAC,cAAc,CAAC,eAAe,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAC9F,CAAC;4BACG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;wBAC9C,CAAC;oBACL,CAAC;oBACD,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,IAAI,eAAe,CAAC,cAAc,CAAC,CACxF,CAAC;wBACG,cAAc,CAAC,eAAe,CAAC,aAAa,CAAC,IAAI,qBAAqB,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;oBACrI,CAAC;gBACL,CAAC;aACJ;YACD,QAAQ,EAAU,UAAS,KAAK,EAAE,IAAI;YAGtC,CAAC;SAEJ,CAAC,CAAC;QAEH,CAAC,CAAC,UAAU,CAAC;aACR,QAAQ,CAAC,iBAAiB,CAAC,CAAC;QAEjC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;IACtC,CAAC;CACR;AAGD,IAAI,mBAAmB,GAAG;IAEtB,EAAE,CAAC,CAAC,CAAC,CAAC,sBAAsB,CAAC;SACpB,UAAU,EAAE,IAAI,CAAC,CAAC,CAC3B,CAAC;QACG,CAAC,CAAC,sBAAsB,CAAC;aACpB,UAAU,CAAC,CAAC,CAAC,CAAC;IACvB,CAAC;AACL,CAAC,CAAC;AAGF,kBAAmB,SAAQ,MAAM;IAK7B,YAAY,OAAgB,EAAE,cAA2B;QAEjD,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,OAAO,GAAI,OAAO,CAAC;QACxB,IAAI,CAAC,QAAQ,GAAG,cAAc,CAAC;IACnC,CAAC;IAEK,QAAQ;QAEV,MAAM,CAAC,UAAU,CAAC;IACtB,CAAC;IAEK,UAAU;QAEZ,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,2BAA2B,EAAE;YAElD,IAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,IAAI,CAAC,KAAK,EAAE,CAAC;QACjB,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,4BAA4B,EAAE,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;QAC3E,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,CAAC;IAC5C,CAAC;CACR","sourcesContent":["import FancytreeOptions = Fancytree.FancytreeOptions;\n\n/**\n * Created by dorianmueller on 23.05.2017.\n * Reworked by Dario GÃ¶tze\n */\n\n/**\n * Interface to access the BeastController\n * getLibraries get the libraries from the BeastController whereas contextDelete() accesses the corresponding in the\n * BeastController\n * TODO either migrate to this and implement it in BEAST Controller or deprecate it\n */\ninterface treeControllerInterface\n{\n    \n    getLibraries() : Array<Library>;\n    deleteComponent(event, treeNode);\n    \n}\n\n/**\n * This class is responsible for the tree structure and the functionality of the tree.\n * When it's instantiated it creates a controller from treeControllerInterface and creates an array that takes the\n * data created by createLibs(). Then it builds the JSON (getTreeStructure) to allow the fancytree framework\n * to build the tree-UI (buildtree()).\n */\nclass TreeController\n{\n    \n    public controller : treeControllerInterface;\n    \n    public beastController : BeastController;\n    public tree : any;\n    \n    constructor(BeastController : BeastController)\n        {\n            this.beastController = BeastController;\n            this.tree            = this.buildTree();\n            \n        }\n    \n    private createLibraryNode(lib : Library) : any\n        {\n            const children : Array<any> = [];\n            lib.components.forEach((cmp) =>\n                                   {\n                                       children.push(this.createComponentNode(cmp.name, new GlobalComponentTypeID(lib.ID, cmp.ID)));\n                                   });\n            return {\n                title : lib.name, folder : true, hideCheckbox : true, key : lib.ID, children : children\n            };\n        }\n    \n    private createComponentNode(name : string, ID : GlobalComponentTypeID) : any\n        {\n            return {\n                title : name, key : ID.componentID, data : ID\n            };\n        }\n    \n    /**\n     * getTreeStructure() constructs the basis data structure.\n     */\n    private getTreeStructure() : Array<any>\n        {\n            const treeStructure = [];\n            this.beastController.getLibraries()\n                .forEach((lib) =>\n                         {\n                             treeStructure.push(this.createLibraryNode(lib));\n                         });\n            return treeStructure;\n        }\n    \n    public reloadTree()\n        {\n            this.tree\n                .reload(this.getTreeStructure());\n        }\n    \n    /**\n     * addLibrary() adds a new LibraryNode to treeStructure\n     * @param lib\n     */\n    public addLibrary(lib : Library)\n        {\n            this.tree\n                .getRootNode()\n                .addChildren(this.createLibraryNode(lib));\n        }\n    \n    public addComponent(componentID : GlobalComponentTypeID)\n        {\n            this.getNodeByID(componentID.libraryID)\n                .addChildren(this.createComponentNode(this.beastController.resolveComponentType(componentID).name, componentID));\n        }\n    \n    public getNodeByID(ID : string) : any\n        {\n            return this.tree\n                       .getNodeByKey(ID);\n        }\n    \n    /**\n     * Deletes a single component specified by the given node\n     *\n     * @param treeNode\n     */\n    private deleteNode(treeNode)\n        {\n            if (treeNode.isFolder())\n            {\n                if (this.beastController.deleteLibrary(treeNode.key))\n                {\n                    treeNode.remove();\n                }\n            }\n            else\n            {\n                if (this.beastController.deleteSingleComponent(treeNode.data))\n                {\n                    treeNode.remove();\n                }\n            }\n        };\n    \n    private createDeleteDialog(node)\n        {\n            let message;\n            if (node.isFolder() && !BeastController.isBasicLibrary(node.key))\n            {\n                message = 'Are you sure you want to delete the library \"' + node.title + '\"?';\n            }\n            else if (!node.isFolder() && !BeastController.isReadOnlyLibrary(node.parent.key))\n            {\n                message = 'Are you sure you want to delete the component \"' + node.title + '\"?';\n            }\n            else\n            {\n                //invalid node\n                return;\n            }\n            new DeleteDialog(message, () =>\n            {\n                this.deleteNode(node);\n            }).show();\n        }\n    \n    /**\n     * buildTree() creates the tree in the document. This method uses the fancytree framework.\n     */\n    private buildTree() : any\n        {\n            let treeController = this; //passed to the callback\n            const $tree        = $('#tree');\n            $tree.fancytree(<FancytreeOptions> {\n                \n                checkbox        : false,\n                debugLevel      : 0,\n                selectMode      : 3,\n                source          : this.getTreeStructure(),\n                clickFolderMode : 2,\n                quicksearch     : true,\n                minExpandLevel  : 1,\n                extensions      : ['contextMenu', 'dnd', 'edit', 'glyph'],\n                //TODO find a way to disable contextMenu\n                contextMenu     : {\n                    menu    : function(node)\n                    {\n                        const basic     = BeastController.isBasicLibrary(node.key);\n                        const editBut   = node.isFolder() || node.parent.key == BeastController.BASIC_LIB_ID;\n                        const deleteBut = basic || BeastController.isReadOnlyLibrary(node.parent.key);\n                        return {\n                            'edit'   : {name : 'Edit', 'icon' : 'edit', disabled : editBut},\n                            'sep1'   : '---------',\n                            'delete' : {name : 'Delete', 'icon' : 'delete', disabled : deleteBut}\n                        };\n                    },\n                    actions : function(node, action)\n                    {\n                        if (action == 'delete')\n                        {\n                            treeController.createDeleteDialog(node);\n                        }\n                        if (action == 'edit')\n                        {\n                            treeController.beastController.workspaceController.openComponent(node.data);\n                        }\n                    }\n                },\n                click           : function(event, data) : boolean\n                {\n                    $('.fancytree-container')\n                        .unbind('scroll', avoidHorizontalZoom);\n                    if (event.which == 3 && BeastController.isBasicLibrary(data.node.key))\n                    {\n                        return false;\n                    }\n                    return true;\n                },\n                dblclick        : function(event, data) : boolean\n                {\n                    if (data.node.isFolder() || data.node.data.libraryID === BeastController.BASIC_LIB_ID)\n                    {\n                        return false;\n                    }\n                    treeController.beastController.workspaceController.openComponent(data.node.data);\n                    return true;\n                },\n                keydown         : function(event, data)\n                {\n                    switch (event.which)\n                    {\n                        case 16:\n                            data.node.toggleSelected();\n                            return true;\n                        case 46:\n                            treeController.createDeleteDialog(data.node);\n                            return true;\n                        default:\n                            return true;\n                    }\n                },\n                glyph           : {\n                    map : {\n                        doc              : 'glyphicon glyphicon-compressed',\n                        docOpen          : 'glyphicon glyphicon-file',\n                        checkbox         : 'glyphicon glyphicon-unchecked',\n                        checkboxSelected : 'glyphicon glyphicon-check',\n                        checkboxUnknown  : 'glyphicon glyphicon-share',\n                        dragHelper       : 'glyphicon glyphicon-play',\n                        dropMarker       : 'glyphicon glyphicon-arrow-right',\n                        error            : 'glyphicon glyphicon-warning-sign',\n                        expanderClosed   : 'glyphicon glyphicon-menu-right',\n                        expanderLazy     : 'glyphicon glyphicon-menu-right',  // glyphicon-plus-sign\n                        expanderOpen     : 'glyphicon glyphicon-menu-down',  // glyphicon-collapse-down\n                        folder           : 'glyphicon glyphicon-folder-close',\n                        folderOpen       : 'glyphicon glyphicon-folder-open',\n                        loading          : 'glyphicon glyphicon-refresh glyphicon-spin'\n                    }\n                },\n                icon            : function(event, data)\n                {\n                    if (data.node.isFolder() && data.node.key === BeastController.DEPOSIT_LIB_ID)\n                    {\n                        return 'glyphicon glyphicon-save';\n                    }\n                    else\n                    {\n                        switch (data.node.data.libraryID)\n                        {\n                            case BeastController.BASIC_LIB_ID:\n                                return 'glyphicon glyphicon-object-align-horizontal';\n                            case BeastController.DEPOSIT_LIB_ID:\n                                return 'glyphicon glyphicon-wrench';\n                        }\n                    }\n                },\n                dnd             : {\n                    autoExpandMS          : 400,\n                    focusOnClick          : true,\n                    preventVoidMoves      : true, // Prevent dropping nodes 'before self', etc.\n                    preventRecursiveMoves : true, // Prevent dropping nodes on own descendants\n                    dragStart             : function(node, data)\n                    {\n                        $('.fancytree-container')\n                            .bind('scroll', avoidHorizontalZoom);\n                        return !BeastController.isBasicLibrary(node.key);\n                    },\n                    dragEnter             : function(node, data)\n                    {\n                        \n                        //dragging for reordering user defined libraries\n                        if (node.parent === data.otherNode.parent && !BeastController.isReadOnlyLibrary(node.key) && !BeastController.isReadOnlyLibrary(node.parent.key))\n                        {\n                            //TODO maybe allow insert before first child\n                            return 'after';\n                        }\n                        //drag component from deposit into a user defined library\n                        //data.otherNode is the dragged component\n                        if (data.otherNode.parent.key == BeastController.DEPOSIT_LIB_ID && node.isFolder() && !BeastController.isReadOnlyLibrary(node.key))\n                        {\n                            return 'over';\n                        }\n                        return false;\n                    },\n                    dragDrop              : function(node, data)\n                    {\n                        /** This function MUST be defined to enable dropping of items on\n                         *  the tree.\n                         */\n                        \n                        \n                        //TODO according to fancytree docs, there are cases when some of the used fields can be null\n                        \n                        \n                        //assert that both nodes are libraries\n                        if (node.isFolder() && data.otherNode.isFolder())\n                        {\n                            if (node.isFolder() && treeController.beastController.reorderLibraryAfter(node.key, data.otherNode.key))\n                            {\n                                data.otherNode.moveTo(node, data.hitMode);\n                            }\n                            else if (treeController.beastController.reorderComponentAfter(node.data, data.otherNode.data))\n                            {\n                                data.otherNode.moveTo(node, data.hitMode);\n                            }\n                        }\n                        else if (node.isFolder() && data.otherNode.parent.key == BeastController.DEPOSIT_LIB_ID)\n                        {\n                            treeController.beastController.copyComponent(new GlobalComponentTypeID(data.otherNode.parent.key, data.otherNode.key), node.key);\n                        }\n                    }\n                },\n                activate        : function(event, data)\n                {\n                \n                }\n                \n            });\n            \n            $('#tree ul')\n                .addClass('flex-grow-equal');\n            \n            return $tree.fancytree('getTree');\n        }\n}\n\n\nlet avoidHorizontalZoom = function()\n{\n    if ($('.fancytree-container')\n            .scrollLeft() != 0)\n    {\n        $('.fancytree-container')\n            .scrollLeft(0);\n    }\n};\n\n\nclass DeleteDialog extends Dialog\n{\n    private message : string;\n    private callback : () => void;\n    \n    constructor(message : string, deleteCallback : () => void)\n        {\n            super();\n            this.message  = message;\n            this.callback = deleteCallback;\n        }\n    \n    protected getTitle() : string\n        {\n            return 'Warning!';\n        }\n    \n    protected getContent() : JQuery\n        {\n            this.addButton('Delete', 'glyphicon glyphicon-trash', () =>\n            {\n                this.callback();\n                this.close();\n            });\n            this.addButton('Cancel', 'glyphicon glyphicon-remove', () => this.close());\n            return $('<p>' + this.message + '</p>');\n        }\n}"]}