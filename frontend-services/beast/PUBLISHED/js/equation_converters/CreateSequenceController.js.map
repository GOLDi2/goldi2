{"version":3,"file":"CreateSequenceController.js","sourceRoot":"","sources":["CreateSequenceController.ts"],"names":[],"mappings":"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","sourcesContent":["\n///<reference path=\"../d_ts/jquery.d.ts\" />\n///<reference path=\"../d_ts/jqueryui.d.ts\" />\n\nclass CreateSequenceController {\n\n    private equationsState = [];\n    private equationsOutput = [];\n    // private numberOfStates: number = 0;\n    // private numberOfOutputs: number = 0;\n    // private areListenersAdded = false;\n    private dialog: SequenceComponentCreationDialog;\n    public onSubmit: (componentName: string, equations) => void;\n    public onError: (errors: string[]) => void;\n\n    constructor() {\n        this.dialog = new SequenceComponentCreationDialog();\n    }\n\n    public setListeners() {\n        // if (this.areListenersAdded) return;\n        // this.areListenersAdded = true;\n\n        const content = this.dialog.content;\n        content.find(\"#AddStateButton\")\n            .on('click', this.addStatesLine.bind(this));\n        content.find('#RemoveStateButton')\n            .on('click', this.removeStatesLine.bind(this));\n        content.find(\"#AddOutputButton\")\n            .on('click', () => { this.addOutputsLine(); });\n        content.find('#RemoveOutputButton')\n            .on('click', this.removeOutputsLine.bind(this));\n        content.find('#SequenceReadyBtn')\n            .on('click', this.retrieveEquations.bind(this));\n        content.find('#outputsTabBtn')\n            .on('click', this.showOutputs);\n        content.find('#statesTabBtn')\n            .on('click', this.showStates);\n        content.find('#SequenceCancelBtn')\n            .on('click', this.close.bind(this));\n    }\n\n    public show() {\n        // $('#sequence-params').show();\n        this.dialog.show();\n        this.setListeners();\n    }\n\n    public close() {\n        $('#sequence-params').hide();\n        this.dialog.close();\n        this.clear();\n    }\n\n    public addOutputsLine() {\n        this.equationsOutput.push('');\n        this.redraw();\n    }\n\n    public addStatesLine() {\n        this.equationsState.push('');\n        this.redraw();\n    }\n\n\n    public removeOutputsLine() {\n        if (this.equationsOutput.length < 1) {\n            return;\n        }\n        this.equationsOutput.pop();\n        this.redraw();\n    }\n\n    public removeStatesLine() {\n        if (this.equationsState.length < 1) {\n            return;\n        }\n        this.equationsState.pop();\n        this.redraw();\n    }\n\n    public redraw() {\n        let content = '';\n        for (let i = 0; i < this.equationsOutput.length; i++) {\n            content += '<div class=\"input-group\">';\n            content += '<span class=\"input-group-addon\">y' + i + ' =&nbsp</span>';\n            content += '<input rows=\"1\" value=\"' + this.equationsOutput[i] + '\" placeholder=\"Expression\" style=\"display:inline-block; width:85%\" type=\"text\" ' +\n                    'class=\"form-control expression\" data-name=\"' + i + '\" data-type=\"output\"></input>';\n            content += '</div><br>'\n        }\n\n        this.dialog.content.find('#OutputEquationsWrapper').html(content);\n\n        content = '';\n        for (let i = 0; i < this.equationsState.length; i++) {\n            content += '<div class=\"input-group\">';\n            content += '<span class=\"input-group-addon\">z' + i + ' =&nbsp</span>';\n            content += '<input rows=\"1\" value=\"' + this.equationsState[i] + '\" placeholder=\"Expression\" style=\"display:inline-block; width:85%\" type=\"text\" ' +\n                    'class=\"form-control expression\" data-name=\"' + i + '\" data-type=\"state\"></input>';\n            content += '</div><br>'\n        }\n\n        this.dialog.content.find('#StateEquationsWrapper').html(content);\n\n        const eqO = this.equationsOutput;\n        const eqS = this.equationsState;\n        $(\".expression\").on(\"change paste keyup\", function() {\n            const elem = $(this);\n            if (elem.data('type') === 'output') {\n                eqO[elem.data('name')] = elem.val();\n            } else if (elem.data('type') === 'state') {\n                eqS[elem.data('name')] = elem.val();\n            }\n        });\n    }\n\n    public retrieveEquations() {\n        const errors = this.checkForErrors();\n        if (errors.length > 0) {\n            this.onError(errors);\n            return;\n        }\n        const equations = {\n            z: [],\n            y: []\n        };\n        this.equationsOutput.forEach((value, index) => {\n            equations.y.push({\n                name: 'y' + index,\n                expression: value\n            });\n        });\n        this.equationsState.forEach((value, index) => {\n            equations.z.push({\n                name: 'z' + index,\n                expression: value\n            });\n            equations.y.push({\n                name: 'z' + index,\n                expression: 'z' + index\n            })\n        });\n\n        this.onSubmit($('#ComponentNameInput').val(), equations);\n    }\n\n\n    private checkForErrors() : string[] {\n        let errors: string[] = [];\n        if (this.equationsOutput.length < 1) {\n            errors.push('There should be at least 1 output expression')\n        }\n        if (this.equationsState.length < 1) {\n            errors.push('There should be at least 1 state expression')\n        }\n        this.equationsOutput.forEach((value, index) => {\n            if (value.length < 1) {\n                errors.push('Expression y' + index + ' can\\'t be empty');\n                return;\n            }\n        });\n        this.equationsState.forEach((value, index) => {\n            if (value.length < 1) {\n                errors.push('Expression z' + index + 'can\\'t be empty');\n                return;\n            }\n        });\n        if ($('#ComponentNameInput').val().length < 1) {\n            errors.push('Component should have a name');\n        }\n        return errors;\n    }\n\n    private showOutputs() {\n        $('#outputs')\n            .show();\n        $('#states')\n            .hide();\n    }\n\n    private showStates() {\n        $('#states')\n            .show();\n        $('#outputs')\n            .hide();\n    }\n\n    public clear() {\n        this.equationsState = [];\n        this.equationsOutput = [];\n        this.redraw();\n    }\n}\n\nclass SequenceComponentCreationDialog extends Dialog {\n    protected nameInput: JQuery;\n    public content: JQuery;\n\n    constructor() {\n        super({\n            width: '80%',\n            height: 700\n        });\n    }\n\n    protected getTitle(): string {\n        return 'Create new component';\n    }\n\n    protected getContent(): JQuery {\n        this.content = $('<div></div>');\n        this.content.append(' <div id=\"sequence-params\">\\n' +\n            '            <!-- Nav tabs -->\\n' +\n            '            <ul class=\"nav nav-tabs nav-justified\" role=\"tablist\">\\n' +\n            '               \\t<li class=\"active\"><a id=\"outputsTabBtn\" href=\"#outputs\" role=\"tab\" data-toggle=\"tab\">Outputs y</a></li>\\n' +\n            '                <li><a id=\"statesTabBtn\" href=\"#states\" role=\"tab\" data-toggle=\"tab\">States z</a></li>\\n' +\n            '            </ul>\\n' +\n            '\\n' +\n            '            <div class=\"sequence-wrapper\">\\n' +\n            '                <div class=\"equations-wrapper\">\\n' +\n            '                <div class=\"tab-pane fade in active\" id=\"outputs\" >\\n' +\n            '                    <div id=\"OutputEquationsWrapper\" class=\"equationsGroup\"></div>\\n' +\n            '                    <div class=\"btn-group controlButtons\">\\n' +\n            '                        <button id=\"AddOutputButton\" type=\"button\" class=\"btn btn-default\" >\\n' +\n            '                            <span class=\"glyphicon glyphicon-plus\"></span>\\n' +\n            '                        </button>\\n' +\n            '                        <button id=\"RemoveOutputButton\" type=\"button\" class=\"btn btn-default\" >\\n' +\n            '                            <span class=\"glyphicon glyphicon-remove\"></span>\\n' +\n            '                        </button>\\n' +\n            '                    </div>\\n' +\n            '                </div>\\n' +\n            '                <div id=\"states\">\\n' +\n            '                    <div id=\"StateEquationsWrapper\" class=\"equationsGroup\"></div>\\n' +\n            '                    <div class=\"btn-group controlButtons\">\\n' +\n            '                        <button id=\"AddStateButton\" type=\"button\" class=\"btn btn-default\">\\n' +\n            '                            <span class=\"glyphicon glyphicon-plus\"></span>\\n' +\n            '                        </button>\\n' +\n            '                        <button id=\"RemoveStateButton\" type=\"button\" class=\"btn btn-default\" >\\n' +\n            '                            <span class=\"glyphicon glyphicon-remove\"></span>\\n' +\n            '                        </button>\\n' +\n            '                    </div>\\n' +\n            '                </div>\\n' +\n            '                </div>\\n' +\n            '                <div id=\"SubmitSequenceWrapper\">\\n' +\n            '                    <input type=\"text\" placeholder=\"Component name\" class=\"form-control\" id=\"ComponentNameInput\" >\\n' +\n            '                    <button id=\"SequenceReadyBtn\" type=\"button\" class=\"btn btn-default\" style=\"display:inline-block\"\\n' +\n            '                            title=\"Submit\">Submit</button>\\n' +\n            '                    <button id=\"SequenceCancelBtn\" type=\"button\" class=\"btn btn-default\" style=\"display:inline-block\"\\n' +\n            '                            title=\"Cancel\">Cancel</button>\\n' +\n            '                </div>\\n' +\n            '\\n' +\n            '            </div>\\n' +\n            '\\n' +\n            '    </div>');\n\n        return this.content;\n    }\n\n    confimedEvent = () => {\n        const val: string = this.nameInput.val();\n        if (val.length != 0) {\n            this.close();\n        }\n    };\n}\n"]}