<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>Title</title>
		<link rel="stylesheet" type="text/css" href="choose.css">
	</head>

	<body class="back-ground">
		<h1 class="überSchrift"> WIDE_WEB Standalone</h1>
		<div class="list">
            <!-- Steuereinhiet auswählen -->
			<form action="index.php" id="form" method="get" class="form-class">
				Steuereinheit:
				<select id="BPU" name="BPUType">
					<option id="v" name="none" value="click">--- Bitte auswählen ---</option>
					<option id="mc" name="MicroController" value="MicroController">Microcontroller</option>
					<option id="pl" name="PLD" value="ProgrammableLogicDevice">PLD</option>
				</select>
			</form>
			<br>
			<form action="index.php" id="form1" method="get" class="form-class">
                <!-- Platzhalter für it JavaScript erstelltes Formular -->
			</form>

			<script type="application/javascript">
                let BPUTypte = document.getElementById("BPU");
                BPUTypte.addEventListener('change', chkBPU);

                //GetPermittedDeviceCombinations JSON from Server
                let answer;
                let requestURL =
                    'https://cors.io/?http://x105.theoinf.tu-ilmenau.de/WIDEDEV/index.php?Function=GetPermittedDeviceCombinations&Location=IUTDev';
                let request = new XMLHttpRequest();

                request.open('GET', requestURL);
                request.responseType = 'json';
                request.onload = function () {
                    answer = request.response;
                    console.log(answer);
                };

                request.onerror = function () {
                    console.log('There was an error!');
                };
                request.send();

                /**
				 * Aufbau des erweiterten Formulars
				 * anhand der getroffenen Auswahl für BPU
                 * @param event Ereignis, welches zum Funktionsaufruf führte
                 */
                function chkBPU(event) {
                    var gewaehlt = false;
                    let BPUType = this.value;
                    var addStr = "<input type='hidden' name='BPUType' id='BPU1'>";

                    // Auswerten der BPU-Auswahl
                    if (this.value != "click") {
                        gewaehlt = true;
                        if (this.value === "MicroController") {
                            addStr += "Programmiersprache:" +
                                "<select name='Lang' id='Lang'>" +
                                "<option name='C' value='cpp'>C</option>" +
                                "</select>"
                        } else {
                            addStr += "Programmiersprache:" +
                                "<select name='Lang' id='Lang'>" +
                                "<option name='LogIC' value='LogIC'>LogIC</option>" +
                                "<option name='VHDL' value='VHDL'>VHDL</option>" +
                                "</select>"
                        }

                        // create Options for Physisches System "select"
                        addStr += `<br><br>
                        Physisches System:<select name='PSPUType' id='PSPU'>`;

                        let devList = answer[`${BPUType}`];
                        let devListReal = devList.Real;
                        let devListVirtual = devList.Virtual;
                        let devices = [];
                        if (devListReal != null) {
                            buildOptions(devListReal);
                        }

                        if (devListVirtual != null) {
                            buildOptions(devListVirtual);
                        }

                        /**
						 * Aufbauen der duplikatfreien Liste der Elaubten physischen Systeme
						 * anhand der übergebenen Liste
                         * @param list
                         */
                        function buildOptions(list) {
                            for (key in list) {
                                if (!devices.includes(key)) {
                                    addStr +=
                                        `<option name='${key}' value='${key}'>${key}</option>`;
                                    devices.push(key);
                                }
                            }
                        }
                        addStr += "</select>";

                    } else {
                        // leeres Formular zurückliefern -> keine Auswahl
                        form1.innerHTML = "";
                    }
                    if (gewaehlt === true) {
                        form1.innerHTML = "";
                    }

                    // erstelltes Formular ausgeben
                    form1.innerHTML += addStr;
                    let controlUnit = document.getElementById("BPU1");
                    controlUnit.value = BPUType;

                    form1.innerHTML += `<br><br>
						<form action="input_button.htm">
							<input type="button" name="Verweis" value="Zur WIDE Seite" onClick="self.location.href='http://localhost/SWPWIDE/Src/WIDE_OLD/WIDE/dist/WIDE/index.html?'+'standalone=true'+'&BPUType='+document.getElementById('BPU').value+'&Lang='+document.getElementById('Lang').value+'&PSPUType='+document.getElementById('PSPU').value">
						</form>
                        <input type='reset' name='R' value='Zurücksetzen' class='button'>
						`;
                }
			</script>
		</div>
	</body>

</html>