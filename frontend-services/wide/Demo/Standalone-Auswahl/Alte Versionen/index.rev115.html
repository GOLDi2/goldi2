<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>Title</title>
        <link rel="stylesheet" type="text/css" href="choose.css">
    </head>

    <body class="back-ground">
        <h1 class="überSchrift"> WIDE_WEB Standalone</h1>
        <div class="list">
            <form action="index.php" id="form" method="get" class="form-class">
                Steuereinheit:
                <select id="BPU" name="BPUType">
                    <option id="v" name="none" value="click">--- Bitte auswählen ---</option>
                    <option id="mc" name="MicroController" value="MicroController">Microcontroller</option>
                    <option id="pl" name="PLD" value="ProgrammableLogicDevice">PLD</option>
                </select>
            </form>
            <br>
            <form action="index.php" id="form1" method="get" class="form-class">
            </form>

            <script type="application/javascript">
                let BPUTypte = document.getElementById("BPU");
                BPUTypte.addEventListener('change', chkBPU);

                //GetPermittedDeviceCombinations JSON from Server

                let answer;
                let requestURL =
                    'https://cors.io/?http://x105.theoinf.tu-ilmenau.de/WIDEDEV/index.php?Function=GetPermittedDeviceCombinations&Location=IUTDev';
                let request = new XMLHttpRequest();

                request.open('GET', requestURL);
                request.responseType = 'json';
                request.onload = function () {
                    answer = request.response;
                    console.log(answer);
                };
                request.onerror = function () {
                    console.log('There was an error!');
                };
                request.send();


                function chkBPU(event) {
                    var gewaehlt = false;
                    let BPUType = this.value;
                    var addStr = "<input type='hidden' name='BPUType' id='BPU1'>";

                    if (this.value != "click") {
                        gewaehlt = true;

                        if (this.value === "MicroController") {
                            addStr += "Programmiersprache:" +
                                "<select name='Lang' disabled>" +
                                "<option name='C' value='C'>C</option>" +
                                "</select>"
                        } else {
                            addStr += "Programmiersprache:" +
                                "<select name='Lang'>" +
                                "<option name='LogIC' value='LogIC'>LogIC</option>" +
                                "<option name='VHDL' value='VHDL'>VHDL</option>" +
                                "</select>"

                        }

                        // create Options for Physisches System "select"

                        function buildOptions() {
                            let optionsArr = [];
                            let elementArr = [];
                            let VirtualReal = [];


                            for (let i in answer[BPUType]) {
                                VirtualReal.push(i);
                            }
                            for (let j = 0; j < VirtualReal.length; j++) {
                                if (elementArr.length === 0) {
                                    for (let x in answer[BPUType][VirtualReal[j]]) {
                                        elementArr.push(x);

                                        optionsArr.push('<option key={j} value="{j}">' + x + '</option>');
                                    }
                                } else {
                                    for (let z in answer[BPUType][VirtualReal[j]]) {
                                        if (elementArr.includes(z)) {

                                        } else {
                                            optionsArr.push('<option key={j} value="{j}">' + z + '</option>');
                                        }
                                    }

                                }

                            }


                            return optionsArr;
                        }


                        addStr += "<br><br>" +
                            "Physisches System:" +
                            "<select> " +

                            buildOptions() +

                            "</select>" +
                            "<br><br>" +
                            "<input type='submit' name='OK' value='Konfiguration laden' class='button' >" +
                            "<input type='reset' name='R' value='Zurücksetzen' class='button'>";


                    } else {
                        form1.innerHTML = "";
                    }
                    if (gewaehlt === true) {
                        form1.innerHTML = "";
                    }
                    form1.innerHTML += addStr;
                    let controlUnit = document.getElementById("BPU1");
                    controlUnit.value = BPUType;

                }
            </script>
        </div>
    </body>

</html>